<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <link rel="stylesheet" href="style.css">
  <script src="assets/tailwind.min.js"></script>
  <script src="assets/lucide.min.js"></script>
  <style>
    body { background: transparent; color: white; overflow: hidden; }
    .cat-chip {
      flex-shrink: 0; padding: 5px 12px; border-radius: 99px; font-size: 10px; font-weight: 800;
      background: rgba(255, 255, 255, 0.05); border: 1px solid rgba(255, 255, 255, 0.08);
      color: #94a3b8; transition: all 0.2s cubic-bezier(0.4, 0, 0.2, 1);
    }
    .cat-chip:hover { 
      background: rgba(168, 85, 247, 0.1); color: #c084fc; border-color: rgba(168, 85, 247, 0.3);
      transform: translateY(-1px);
    }
    .cat-chip.active { 
      background: #7c3aed; border-color: #a855f7; color: white; box-shadow: 0 4px 12px rgba(124, 58, 237, 0.3);
    }
    .abbr-card {
      background: rgba(30, 35, 60, 0.4); border: 1px solid rgba(255, 255, 255, 0.05);
      border-radius: 16px; padding: 14px; transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
    }
    .abbr-card:hover { 
      background: rgba(168, 85, 247, 0.08); border-color: rgba(168, 85, 247, 0.4);
      transform: translateY(-2px); box-shadow: 0 8px 20px rgba(0, 0, 0, 0.2);
    }
    .abbr-badge {
      font-size: 11px; font-weight: 900; color: #c084fc; background: rgba(168, 85, 247, 0.15);
      padding: 3px 8px; border-radius: 8px; border: 1px solid rgba(168, 85, 247, 0.2); display: inline-block;
    }
    .drag-handle {
      padding: 18px 20px; cursor: move; -webkit-app-region: drag;
      background: linear-gradient(to bottom, rgba(168, 85, 247, 0.15), transparent);
      border-bottom: 1px solid rgba(255, 255, 255, 0.05);
    }
    .no-drag { -webkit-app-region: no-drag; }
  </style>
</head>
<body class="panel-glass p-0 h-screen flex flex-col">
  <!-- Header -->
  <div class="drag-handle flex justify-between items-center shadow-lg">
    <div class="flex items-center gap-3">
      <div class="w-8 h-8 bg-purple-500/20 rounded-lg flex items-center justify-center border border-purple-500/30">
        <i data-lucide="book-open" class="w-5 h-5 text-purple-400"></i>
      </div>
      <div class="flex flex-col">
        <span class="text-xs font-black text-white tracking-tight">테일즈 약어 사전</span>
        <span class="text-[9px] text-slate-500 font-bold uppercase tracking-wider">Tales Dictionary</span>
      </div>
    </div>
    <button onclick="window.close()" class="no-drag w-8 h-8 flex items-center justify-center hover:bg-white/5 rounded-full transition-colors">
      <i data-lucide="x" class="w-4 h-4 text-slate-400"></i>
    </button>
  </div>

  <div class="flex-1 overflow-hidden flex flex-col p-4 space-y-4 no-drag">
    <!-- 검색 입력 -->
    <div class="relative group">
      <i data-lucide="search" class="absolute left-3.5 top-1/2 -translate-y-1/2 w-4 h-4 text-slate-500 group-focus-within:text-purple-400 transition-colors"></i>
      <input id="search-input" class="input-field w-full pl-10 pr-4 py-3 text-sm bg-black/40 border-white/10 rounded-xl focus:border-purple-500 transition-all" 
             placeholder="약어 또는 풀네임 검색..." oninput="handleSearch()">
    </div>

    <!-- 카테고리 칩 -->
    <div id="category-container" class="flex gap-2 overflow-x-auto pb-2 custom-scroll shrink-0">
      <button class="cat-chip active" onclick="filterCategory('전체')">전체</button>
      <button class="cat-chip" onclick="filterCategory('캐릭터')">캐릭터</button>
      <button class="cat-chip" onclick="filterCategory('던전')">던전</button>
      <button class="cat-chip" onclick="filterCategory('필드 보스')">보스</button>
      <button class="cat-chip" onclick="filterCategory('스페셜 스킬')">스킬</button>
      <button class="cat-chip" onclick="filterCategory('팀 게시판')">팀게</button>
      <button class="cat-chip" onclick="filterCategory('실전 예시')">예시</button>
    </div>

    <!-- 결과 리스트 -->
    <div id="result-list" class="flex-1 custom-scroll overflow-y-auto space-y-3 pr-1"></div>

    <!-- 출처 표시 -->
    <div class="pt-3 border-t border-white/5 shrink-0">
      <div class="flex flex-col gap-1 items-center">
        <p class="text-[9px] text-slate-600 font-bold">Data Source: <span class="text-purple-400/60 cursor-pointer hover:underline" onclick="window.electronAPI.openExternal('https://tales.nexon.com/Community/Walkthrough/66063')">테일즈위버 공식 홈페이지</span></p>
        <p class="text-[9px] text-slate-700 font-black italic">Author: 하이아칸 서버 - 알롱지</p>
      </div>
    </div>
  </div>

  <script>
    let allData = [];
    let currentCategory = '전체';

    async function loadData() {
      try {
        const response = await fetch('assets/data/abbreviations.json');
        allData = await response.json();
        renderResults();
      } catch (e) {
        console.error('Failed to load abbreviations:', e);
      }
    }

    function renderResults(filterText = '') {
      const list = document.getElementById('result-list');
      list.innerHTML = '';
      
      const query = filterText.toLowerCase().trim();
      
      const filtered = allData.filter(item => {
        if (currentCategory !== '전체' && item.category !== currentCategory) return false;
        if (!query) return true;
        const matchTerm = item.term.toLowerCase().includes(query);
        const matchAbbr = item.abbrs.some(a => a.abbr.toLowerCase().includes(query) || a.desc.toLowerCase().includes(query));
        return matchTerm || matchAbbr;
      });

      if (filtered.length === 0) {
        list.innerHTML = `<div class="flex flex-col items-center justify-center py-20 text-slate-600 gap-3">
          <i data-lucide="search-x" class="w-10 h-10 opacity-20"></i>
          <span class="text-xs font-bold">검색 결과가 없습니다.</span>
        </div>`;
        lucide.createIcons();
        return;
      }

      filtered.forEach(item => {
        const card = document.createElement('div');
        card.className = 'abbr-card space-y-3';
        
        let abbrsHtml = item.abbrs.map(a => `
          <div class="flex flex-col gap-1.5 p-3 bg-black/30 rounded-xl border border-white/5">
            <div><span class="abbr-badge">${a.abbr}</span></div>
            <p class="text-[11px] text-slate-400 leading-relaxed font-medium">${a.desc}</p>
          </div>
        `).join('');

        card.innerHTML = `
          <div class="flex items-center justify-between px-1">
            <div class="flex items-center gap-2">
              <i data-lucide="tag" class="w-3 h-3 text-purple-500 opacity-50"></i>
              <span class="text-xs font-black text-slate-100 tracking-tight">${item.term}</span>
            </div>
            <span class="text-[9px] text-slate-500 font-black bg-white/5 px-2 py-0.5 rounded-full border border-white/5 uppercase">${item.category}</span>
          </div>
          <div class="space-y-2">
            ${abbrsHtml}
          </div>
        `;
        list.appendChild(card);
      });
      lucide.createIcons();
    }

    function handleSearch() {
      const input = document.getElementById('search-input');
      renderResults(input.value);
    }

    function filterCategory(cat) {
      currentCategory = cat;
      const chips = document.querySelectorAll('.cat-chip');
      chips.forEach(chip => {
        const text = chip.innerText;
        const isActive = (text === cat) || 
                         (cat === '전체' && text === '전체') || 
                         (cat === '필드 보스' && text === '보스') || 
                         (cat === '팀 게시판' && text === '팀게') || 
                         (cat === '스페셜 스킬' && text === '스킬') ||
                         (cat === '실전 예시' && text === '예시');
        
        if (isActive) chip.classList.add('active');
        else chip.classList.remove('active');
      });
      handleSearch();
    }

    window.onload = loadData;
    window.addEventListener('keydown', (e) => { if (e.key === 'Escape') window.close(); });
  </script>
</body>
</html>
